<html><head><title>leadz_trailz</title></head><body><table width="100%" cellspacing="0" cellpadding="5" border="1" bgcolor="#c0e1ff">
    <tbody>
        <tr>
            <td width="100%" valign="top" align="left" style="font-family: Arial; color: rgb(0, 0, 128); font-size: 12pt;"><strong>Document Control Information:</strong>
            <p style="color: rgb(0, 0, 0);">The official version of this document is kept in CMVC in the <span style="font-weight: bold; text-decoration: underline;">%CMVC_Family%</span> family, release <span style="font-weight: bold; text-decoration: underline;">%CMVC_Release%</span>, component <span style="font-weight: bold; text-decoration: underline;">%CMVC_Component%</span>, file <span style="color: rgb(255, 102, 102); font-weight: bold; text-decoration: underline;">%CMVC_PathName%</span>. Users of this document are personally responsible for using the official version and for verifying that any copies of the document, in whole or in part, are of the official version. If this document is not a copy of the official version, it is obsolete.<br />
            <br />
            CMVC Extraction Information: %W% %H% %I% sccsid<br />
            <br />
            This document is IBM Confidential.<br />
            </p>
            </td>
        </tr>
    </tbody>
</table>
<br />
<br />
<table cellspacing="0" cellpadding="5" border="1" style="text-align: left; background-color: rgb(224, 255, 191); width: 100%; font-family: Arial; font-size: 12pt;">
    <tbody>
        <tr>
            <td width="20%" valign="top" align="left"><strong>CMVC Feature Number</strong> </td>
            <td width="80%" valign="top" align="left" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 255); font-weight: bold;">%CMVC_Feature%</td>
        </tr>
        <tr>
            <td valign="top" align="left"><strong>Feature Title</strong> </td>
            <td valign="top" align="left" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 255); font-weight: bold;">%Document_Name% %Note{By default the feature title and document name are the same. You can either change the document name (through Properties), or replace the tag with the title of the feature}%</td>
        </tr>
        <tr>
            <td valign="top" align="left"><strong>Author(s)</strong> </td>
            <td valign="top" align="left" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 255); font-weight: bold;">%Authors%</td>
        </tr>
        <tr>
            <td valign="top" align="left"><strong>Applicable Product Releases</strong> </td>
            <td valign="top" align="left" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 255); font-weight: bold;">XL Fortran 14.1 on AIX, Linux, and BGQ</td>
        </tr>
        <tr>
            <td valign="top" align="left"><strong>Affected Components</strong> </td>
            <td valign="top" align="left" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 255); font-weight: bold;"><br />
            Front Ends: Fortran<br />
            Documentation: Product documentation<br />
            </td>
        </tr>
    </tbody>
</table>
<br />
<br />
<table width="100%" cellspacing="0" cellpadding="5" border="1" bgcolor="#ff6666">
    <tbody>
        <tr>
            <td width="100%" valign="top" align="center" style="text-align: left; font-family: Arial; font-size: 12pt;"><strong>Document Status: For Approval</strong> </td>
        </tr>
    </tbody>
</table>
<p><strong>Approvers Only:</strong> Click on the 'Approve' check-box beside your name in the table below if you agree with the technical and user interface content of this document; not checking your 'approve' check-box signifies you do not approve.</p>
<p>%Approvals%</p>
<p>Approval Comments</p>
<p>
<table cellspacing="0" cellpadding="5" border="1" style="text-align: left; background-color: rgb(224, 255, 191); width: 100%; font-family: Arial; font-size: 12pt;">
    <tbody>
        <tr>
            <td valign="top" align="left"><strong>Approvers</strong> (mandatory participation) </td>
            <td valign="top" align="left" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 255); font-weight: bold;">%Note{Insert the names of people who will have approval authority for this review. These people, in aggregate, are responsible for approving the technical and user interface content of the document. Generally, this list should include people who represent compiler components that will need to change if this review is approved.<br />
            The I0 Process document provides detailed guidance on choosing your list of approvers.<br />
            Use Access Control to add/delete people from this list. The initial access control list is populated with the people from the Component Reviewers section below. You can use Access Control to change their role to Approver, or add additional approvers.}%<br />
            %Approvers%</td>
        </tr>
        <tr>
            <td valign="top" align="left"><strong>Release Management Contact</strong> (optional participation) </td>
            <td valign="top" align="left" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 255); font-weight: bold;">%Release_Management_Contact% <br />
            %Note{Release Manager/Development Manager/Team Lead,<br />
            usually your team's representative at product status meetings. Use Access Control to add/change Release Management Contact.}%<br />
            </td>
        </tr>
        <tr>
            <td valign="top" align="left"><strong>Component Reviewers</strong> (optional participation) </td>
            <td valign="top" align="left" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 255);">%Note{These groups must be made aware of the I0. Assign at least one person representing each group. The names listed below are suggested contacts only, please assign whoever is appropriate:<br />
            <ul style="font-family: Arial;">
                <li><strong>C FE and related tools/libraries/driver:</strong><br />
                AIX - Philip Luk<br />
                Linux - Philip Luk<br />
                z/OS - Kendrick Wong<br />
                CELL - Larry Lindsay<br />
                UPC - Philip Luk </li>
                <li><strong>C++ FE and related tools/libraries/driver:</strong><br />
                AIX - Jeff Heath<br />
                Linux - Sasha Kasapinovic<br />
                z/OS - Michael Wong<br />
                CELL - Kevin Shin<br />
                </li>
                <li><strong>Fortran FE, ASTI, PLIX, and related tools/libraries/driver:</strong><br />
                AIX, PLIX - Rafik Zurob<br />
                Linux - Xing Xue<br />
                BG/L - Daniel Chen<br />
                CELL - Kelvin Li </li>
                <li><strong>PL/X Development:</strong><br />
                Kirk Crane<br />
                </li>
                <li><strong>TPO and associated tools/libraries (libxlopt, SMPRT, MASS):</strong><br />
                AIX - Arie Tal/Yan Zhang<br />
                Linux - Tommy Wong<br />
                z/OS - Chris Miclea<br />
                BG - Damien Bonaventure<br />
                CELL - Amy Wang </li>
                <li><strong>TOBEY and associated tools/libraries: (dis, libxl, bolt)</strong><br />
                AIX - Christopher Lapkowski<br />
                Linux - Irina rada<br />
                z/OS - Chwan-Hang Lee<br />
                BG - Damien Bonaventure, Leon Ding (Xialoliang Ding/Piscataway/IBM@IBMUS)<br />
                CELL - Dickson Chau<br />
                dis - Ian McIntosh<br />
                </li>
                <li><strong>WCode:</strong><br />
                Roland Froese </li>
                <li><strong>Disassembler<br />
                </strong>Ian McIntosh </li>
                <li><strong>Information Development:</strong><br />
                C/C++ - Wei Zhong Shan/China/IBM<br />
                Fortran - Lisa Wilkinson<br />
                </li>
                <li><strong>Customer Service and Support:</strong><br />
                AIX/Linux - Zoran Kulina<br />
                z/OS - Youssef Himo <br />
                Cell - Sean Kennedy </li>
                <li><strong>Compiler Enablement:</strong><br />
                Dwayne Moore </li>
                <li><strong>Fortran Test:</strong><br />
                Kobi Vinayagamoorthy<br />
                </li>
                <li><strong>C/C++ Test:</strong><br />
                Thomas Lee(z/OS)<br />
                Adrean Gatea (system p)<br />
                </li>
                <li><strong>PL/X Test:</strong><br />
                Anne Wylie </li>
                <li><strong>Build and Packaging Team:</strong><br />
                AIX - Chris Taylor<br />
                Linux - Viktor Ganich<br />
                BG - Steven Chen<br />
                Cell - Kevin Yuen<br />
                z/OS - Steve Chen<br />
                Dale Soldiuk (Please include Dale as optional on all reviews) </li>
                <li><strong>Performance Measurement and Analysis Team:<br />
                </strong>John Tam </li>
                <li><strong>Planning</strong><br />
                Mary Chan<br />
                </li>
            </ul>
            <p>The following groups must be notified of a W-Code change or if a change affects their language. They are optional otherwise.</p>
            <ul>
                <li><strong>PL/I:</strong><br />
                zOS and AIX - Peter Elderon (in SVL) </li>
                <li><strong>Cobol:</strong><br />
                AIX - Richard Nelson (in SVL) </li>
            </ul>
            <p>The following group must be notified of a front-end (C FE, or C++ FE) related change or other modification having a direct impact. Inclusion is optional otherwise.</p>
            <ul>
                <li><strong>Makedepend for USS:</strong><br />
                Christopher Taylor </li>
            </ul>
            <p>The following group must be notified whenever a change in debug WCODE is made, and any debugger related issues are involved.</p>
            <ul>
                <li><strong>Common Debug Architecture Development (CDA):</strong><br />
                Kendrick Wong </li>
            </ul>
            Use Access Control to add/delete people from this list.}% <br />
            %Component_Reviewers%</td>
        </tr>
        <tr>
            <td valign="top" align="left"><strong>Team Reviewers</strong> (optional participation) </td>
            <td valign="top" align="left" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 255); font-weight: bold;">%Note{List any additional people you feel need to participate in the review. These people do not have approval authority. Use Access Control to add/delete people from this list.}%<br />
            %Team_Reviewers%</td>
        </tr>
    </tbody>
</table>
</p>
<p><br />
<br />
</p>
<p>
<table cellspacing="2" cellpadding="2" border="1" style="text-align: left; background-color: rgb(224, 255, 191); width: 100%; font-family: Arial; font-size: 12pt;">
    <tbody>
        <tr>
            <td style="font-family: Arial; vertical-align: top;"><strong>Reviewers</strong>: Please click the 'Reviewed' checkbox beside your name to indicate your participation in the review. </td>
        </tr>
    </tbody>
</table>
</p>
<p>%Reviews%<br />
</p>
<p>
<table cellspacing="2" cellpadding="2" border="1" style="text-align: left; background-color: rgb(224, 255, 191); width: 100%; font-family: Arial; font-size: 12pt;">
    <tbody>
        <tr>
            <td style="font-family: Arial; vertical-align: top;"><strong>Access Change History</strong> %Note{Authors: Access Change History will list any changes to the access control done to the document draft. These changes would not be visible in a review. In a review, this section would only list the access changes done to the review itself.<br />
            Please note that changes to the access control of a review are not automatically reflected in the access control of the draft document.}% </td>
        </tr>
    </tbody>
</table>
</p>
<p>%CollapsedSection{<strong>Access Change History</strong>}{%Access_Change_History%}%<br />
</p>
<p>
<table width="100%" cellspacing="0" cellpadding="5" border="1" bgcolor="#bfbfff">
    <tbody>
        <tr>
            <td width="100%" valign="top" align="center" style="font-family: Arial; font-size: 12pt;"><strong>Feature Overview</strong> </td>
        </tr>
    </tbody>
</table>
</p>
<p>The Fortran 2008 introduces two bit counting intrinsics: LEADZ and TRAILZ. LEADZ counts the number of leading zero bits in an integer. TRAILZ counts the number of trailing zero bits in an integer. XL Fortran supported LEADZ in the past as an IBM extension.</p>
<h2>Key Requirements</h2>
<ul>
    <li>The LEADZ and TRAILZ intrinsics work on integers of any size. </li>
    <li>The LEADZ and TRAILZ intrinsics are allowed in constant expressions. </li>
</ul>
<br />
<h2>Key Design Issues</h2>
<p>We have a <code>__leadz</code> generic TOBEY bif that accepts integer arguments of any size and returns the correct result for that integer size. There is no generic <code>__trailz</code> TOBEY bif.</p>
<h2>Key Design Decisions</h2>
<p>We'll use the <code>__cnttz4</code> and <code>__cnttz8</code> specific TOBEY bifs to compute TRAILZ for integer(4) and integer(8) arguments, respectively. For integer(1), and integer(2) arguments, we'll use <code>__cnttz4</code> with some manipulation of the argument. (Please refer to the high level implementation section for more details.)</p>
<h2>Testing Strategy</h2>
<p>Test LEADZ and TRAILZ for various values, including zero. Zero is a tricky case for integer(1) and integer(2) arguments because it catches problems with promotion to a bigger data type.</p>
<p>&nbsp;</p>
<table width="100%" cellspacing="0" cellpadding="5" border="1" bgcolor="#bfbfff">
    <tbody>
        <tr>
            <td width="100%" valign="top" align="center" style="font-family: Arial; font-size: 12pt;"><strong>User Documentation</strong> </td>
        </tr>
    </tbody>
</table>
<strong style="color: rgb(0, 128, 0); font-size: 20px;">
<h3>Overview</h3>
</strong>
<p>The Fortran 2008 LEADZ intrinsic function counts the number of leading zero bits in the binary representation of an integer value. The Fortran 2008 TRAILZ intrinsic function counts the number of trailing zero bits in the binary representation of an integer value.</p>
<strong style="color: rgb(0, 128, 0); font-size: 20px;">
<h3>User Benefits</h3>
</strong>
<p>The new LEADZ and TRAILZ intrinsic functions provide a standard, portable way of counting bits.</p>
<strong style="color: rgb(0, 128, 0); font-size: 20px;">
<h3>Public Interface</h3>
</strong>
<p><strong>LEADZ(I) (Fortran 2008)</strong></p>
<p><strong>Purpose</strong></p>
<p>Number of leading zero bits</p>
<p><strong>Class</strong></p>
<p>Elemental function</p>
<p><strong>Argument type and attributes</strong></p>
<dl><dt>I</dt><dd>must be of type integer</dd></dl>
<p><strong>Result type and attributes</strong></p>
<p>Same as I</p>
<p><strong>Result value</strong></p>
<p>The result is the count of zero bits to the left of the leftmost one-bit for <code>I</code>. If <code>I</code> has the value zero, the result is <code>BIT_SIZE(I)</code></p>
<p><strong>Examples</strong></p>
<pre>i = leadz(0_4)  ! i = 32<br />j = leadz(4_4)  ! j = 29<br />k = leadz(-1)   ! k = 0<br />m = leadz(0_8)  ! m = 64<br />n = leadz(1_8)  ! n = 63<br /></pre>
<p>&nbsp;</p>
<p><strong>TRAILZ(I) (Fortran 2008)</strong></p>
<p><strong>Purpose</strong></p>
<p>Number of trailing zero bits</p>
<p><strong>Class</strong></p>
<p>Elemental function</p>
<p><strong>Argument type and attributes</strong></p>
<dl><dt>I</dt><dd>must be of type integer</dd></dl>
<p><strong>Result type and attributes</strong></p>
<p>Same as I</p>
<p><strong>Result value</strong></p>
<p>The result is the count of zero bits to the right of the rightmost one-bit for <code>I</code>. If <code>I</code> has the value zero, the result is <code>BIT_SIZE(I)</code></p>
<p><strong>Examples</strong></p>
<pre>i = trailz(0_4)  ! i = 32<br />j = trailz(4_4)  ! j = 2<br />k = trailz(-1)   ! k = 0<br />m = trailz(0_8)  ! m = 64<br />n = trailz(1_8)  ! n = 0<br /></pre>
<strong style="color: rgb(0, 128, 0); font-size: 20px;">
<h3>Constraints</h3>
</strong>
<p>The actual argument corresponding to dummy argument <code>I</code> must be an integer, or a typeless argument.</p>
<strong style="color: rgb(0, 128, 0); font-size: 20px;">
<h3>Rules</h3>
</strong>
<p>The LEADZ and TRAILZ intrinsic functions are allowed in constant expressions.</p>
<strong style="color: rgb(0, 128, 0); font-size: 20px;">
<h3>Language Standard Considerations</h3>
</strong>
<p>The LEADZ and TRAILZ functions comply with teh Fortran 2008 standard. They will be flagged with langlvl messages when checking for compliance with earlier standards.</p>
<strong style="color: rgb(0, 128, 0); font-size: 20px;">
<h3>Messages</h3>
</strong>
<p>No new messages are needed. Existing messages cover all constraints and language level checking.</p>
<strong style="color: rgb(0, 128, 0); font-size: 20px;">
<h3>Performance Considerations</h3>
</strong>
<p>LEADZ is implemented in hardware on PPC systems. TRAILZ is implemented in terms of LEADZ.</p>
<strong style="color: rgb(0, 128, 0); font-size: 20px;">
<h3>Multi-Platform/Portability Considerations</h3>
</strong>
<p>None</p>
<strong style="color: rgb(0, 128, 0); font-size: 20px;">
<h3>Migration/Co-Existence/Binary-Compatibility Considerations</h3>
</strong>
<p>None</p>
<strong style="color: rgb(0, 128, 0); font-size: 20px;">
<h3>Debug Considerations</h3>
</strong>
<p>None</p>
<strong style="color: rgb(0, 128, 0); font-size: 20px;">
<h3>NLS (Unicode) Considerations</h3>
</strong>
<p>None</p>
<strong style="color: rgb(0, 128, 0); font-size: 20px;">
<h3>Samples</h3>
</strong>
<p>Please refer to the examples in the Public Interface section above.</p>
<br />
<table width="100%" cellspacing="0" cellpadding="5" border="1" bgcolor="#bfbfff">
    <tbody>
        <tr>
            <td width="100%" valign="top" align="center" style="font-family: Arial; font-size: 12pt;"><strong>Architecture Review Board</strong> </td>
        </tr>
    </tbody>
</table>
<strong style="color: rgb(0, 128, 0); font-size: 20px;"></strong>
<p>No review is needed.</p>
<table width="100%" cellspacing="0" cellpadding="5" border="1" bgcolor="#bfbfff">
    <tbody>
        <tr>
            <td width="100%" valign="top" align="center" style="font-family: Arial; font-size: 12pt;"><strong>Internal Compiler Team Information</strong> </td>
        </tr>
    </tbody>
</table>
<strong style="color: rgb(0, 128, 0); font-size: 20px;">
<h3>Product Dependencies</h3>
</strong>
<p>N/A </p>
<strong style="color: rgb(0, 128, 0); font-size: 20px;">
<h3>Patent/Disclosure Implications</h3>
</strong>
<p>N/A</p>
<strong style="color: rgb(0, 128, 0); font-size: 20px;">
<h3>Scientific Research and Experimental Development</h3></strong>
<p><strong>Technological Advancements</strong>: N/A</p>
<p><strong>Technological Obstacles</strong>: N/A</p>
<p><strong>Work Performed</strong>: N/A</p>
<strong style="color: rgb(0, 128, 0); font-size: 20px;">
<h3>Build and Packaging Considerations</h3>
</strong>
<p>N/A</p>
<strong style="color: rgb(0, 128, 0); font-size: 20px;">
<h3>Information Development Impacts</h3>
</strong>
<p>%Note{List any documentation impacts. What books/chapters/sections are affected? Do the man pages need updating? Are there any new terms or phrases that need to be added to the glossary?}% </p>
<p>1. Add the feature to the F2008 feature list:</p>
<p><a href="http://vaidbld.torolab.ibm.com:10201/help/topic/com.ibm.xlf141.aix.doc/getstart/new_flangupdates_v14.html">http://vaidbld.torolab.ibm.com:10201/help/topic/com.ibm.xlf141.aix.doc/getstart/new_flangupdates_v14.html</a></p>
<p>2. Add the&nbsp;trailz intrinsic to the Elemental intrinsic procedures topic. Change &quot;IBM Extension&quot; to &quot;Fortran 2008&quot; for leadz.</p>
<p><a href="http://vaidbld.torolab.ibm.com:10201/help/topic/com.ibm.xlf141.aix.doc/language_ref/eleintr.html">http://vaidbld.torolab.ibm.com:10201/help/topic/com.ibm.xlf141.aix.doc/language_ref/eleintr.html</a></p>
<p>3. Change &quot;IBM Extension&quot; to &quot;Fortran 2008&quot; for leadz. Add a related link to trailz:</p>
<p><a href="http://vaidbld.torolab.ibm.com:10201/help/topic/com.ibm.xlf141.aix.doc/language_ref/leadz.html">http://vaidbld.torolab.ibm.com:10201/help/topic/com.ibm.xlf141.aix.doc/language_ref/leadz.html</a></p>
<p>4. Add the trailz topic:</p>
<p><a href="http://vaidbld.torolab.ibm.com:10201/help/topic/com.ibm.xlf141.aix.doc/language_ref/intrinsicprocs.html">http://vaidbld.torolab.ibm.com:10201/help/topic/com.ibm.xlf141.aix.doc/language_ref/intrinsicprocs.html</a></p>
<p><strong style="color: rgb(0, 128, 0); font-size: 20px;">Testing Considerations</strong> </p>
<ul>
    <li>Test one left most bit, one right most bits, all zero bits, all one bits, mix of zero and one bits. </li>
    <li>Test argument type, including integer(1), integer(2), integer(4), integer(8), and typeless arguments. </li>
    <li>Test language level checking at -qlanglvl=2003std and -qlanglvl=2008std. </li>
</ul>
<p>&nbsp;</p>
<table width="100%" cellspacing="0" cellpadding="5" border="1" bgcolor="#bfbfff">
    <tbody>
        <tr>
            <td width="100%" valign="top" align="center" style="font-family: Arial; font-size: 12pt;"><strong>High-Level Implementation Design</strong> </td>
        </tr>
    </tbody>
</table>
<strong style="color: rgb(0, 128, 0); font-size: 20px;">
<h3>Implementation Design Overview</h3>
</strong>
<p>The Fortran frontend will fold the LEADZ and TRAILZ intrinsics when <code>I</code> is known at compile time. It will inline the intrinsics in all other cases.</p>
<strong style="color: rgb(0, 128, 0); font-size: 20px;">
<h3>Inter-Component Communication/Interfaces</h3>
</strong>
<p>The following (existing) TOBEY bifs will be used: <code>__leadz</code>, <code>__cnttz4</code>, <code>__cnttz8</code>.</p>
<strong style="color: rgb(0, 128, 0); font-size: 20px;">
<h3>Other Implementation Design Information</h3>
</strong>
<p>For TRAILZ, since we don't have a generic <code>__trailz</code> bif, we'll use the specific <code>__cnttz4</code> and <code>__cnttz8</code> bifs. TOBEY translates those into the following code: </p>
<pre>    i = ~i &amp; (i - 1);<br />    result = sizeof(i) - cntlz(i);<br /></pre>
When <code>I</code> is an integer(1) or integer(2), we will use an integer(4) intermediate value to compute the result as follows:
<pre>    [ CONV i to integer(4) ]<br />    i |= MASK   ! MASK is 0xFFFFFF00 for integer(1) and 0xFFFF0000 for integer(2)<br />    __cnttz4(i)<br />    [ CONV back to integer(1) / integer(2) ]<br /></pre>
Note that we don't expect the integer(1) and integer(2) cases to be common.
<p>&nbsp;</p>
<table width="100%" cellspacing="0" cellpadding="5" border="1" bgcolor="#bfbfff">
    <tbody>
        <tr>
            <td width="100%" valign="top" align="center" style="font-family: Arial; font-size: 12pt;"><strong>Appendix/References</strong> </td>
        </tr>
    </tbody>
</table>
<p>Please refer to sections 13.7.92 (LEADZ) and 13.7.167 (TRAILZ) of the Fortran 2008 standard.</p>
<p>&nbsp;</p><!--HTML Wrapper--></body></html>