<html><head><title>CAF: ERROR STOP statement</title></head><body><table width="100%" cellspacing="0" cellpadding="5" border="1" bgcolor="#c0e1ff">
    <tbody>
        <tr>
            <td width="100%" valign="top" align="left" style="font-size: 12pt; color: rgb(0, 0, 128); font-family: Arial;"><strong>Document Control Information:</strong>
            <p style="color: rgb(0, 0, 0);">The official version of this document is kept in CMVC in the <span style="font-weight: bold; text-decoration: underline;">%CMVC_Family%</span> family, release <span style="font-weight: bold; text-decoration: underline;">%CMVC_Release%</span>, component <span style="font-weight: bold; text-decoration: underline;">%CMVC_Component%</span>, file <span style="font-weight: bold; color: rgb(255, 102, 102); text-decoration: underline;">%CMVC_PathName%</span>. Users of this document are personally responsible for using the official version and for verifying that any copies of the document, in whole or in part, are of the official version. If this document is not a copy of the official version, it is obsolete.<br />
            <br />
            CMVC Extraction Information: %W% %H% %I% sccsid<br />
            <br />
            This document is IBM Confidential.<br />
            </p>
            </td>
        </tr>
    </tbody>
</table>
<br />
<br />
<table cellspacing="0" cellpadding="5" border="1" style="font-size: 12pt; width: 100%; font-family: Arial; background-color: rgb(224, 255, 191); text-align: left;">
    <tbody>
        <tr>
            <td width="20%" valign="top" align="left"><strong>CMVC Feature Number</strong> </td>
            <td width="80%" valign="top" align="left" style="font-weight: bold; color: rgb(0, 0, 255); background-color: rgb(255, 255, 255);">%CMVC_Feature%</td>
        </tr>
        <tr>
            <td valign="top" align="left"><strong>Feature Title</strong> </td>
            <td valign="top" align="left" style="font-weight: bold; color: rgb(0, 0, 255); background-color: rgb(255, 255, 255);">%Document_Name% %Note{By default the feature title and document name are the same. You can either change the document name (through Properties), or replace the tag with the title of the feature}%</td>
        </tr>
        <tr>
            <td valign="top" align="left"><strong>Author(s)</strong> </td>
            <td valign="top" align="left" style="font-weight: bold; color: rgb(0, 0, 255); background-color: rgb(255, 255, 255);">%Authors%</td>
        </tr>
        <tr>
            <td valign="top" align="left"><strong>Applicable Product Releases</strong> </td>
            <td valign="top" align="left" style="font-weight: bold; color: rgb(0, 0, 255); background-color: rgb(255, 255, 255);">
            <p>%Note{ List all the products and their release numbers for which the information in this document is/will be correct. For example:<br />
            XL C/C++ v7.0 and 8.0 on Linux and AIX<br />
            XL Fortran v9.1 and 10.1 on Linux and AIX.<br />
            <br />
            If you are updating this I0, remove old products from the list if they will not support this updated I0's behaviour. For example, if this I0 was first written for XL Fortran v9.1 and a change is being made in XL Fortran v10.1 that will not be ported back to v9.1, then v9.1 should not appear in the list.<br />
            <br />
            For prototype or experimental code that isn't scheduled to ship in any release yet, note possible future targets like this: &quot;Experimental code, may ship in future XL Fortran and XL C/C++ AIX releases&quot; }%</p>
            <p><font color="#000000">XL Fortran V14.1 on aix and linux</font></p>
            </td>
        </tr>
        <tr>
            <td valign="top" align="left"><strong>Affected Components</strong> </td>
            <td valign="top" align="left" style="font-weight: bold; color: rgb(0, 0, 255); background-color: rgb(255, 255, 255);">
            <p>%Note{ List all compiler components affected by the introduction of or changes to this document. If you believe this document will cause a component to add or change code, then you should list it. Use this list as a starting point and add to it as necessary:<br />
            <br />
            Front Ends: C, C++, Fortran, PL/X, PL/1, COBOL, PLIX<br />
            Optimizers: ASTI, TPO, TOBEY<br />
            Libraries: Fortran RT, C++ RT, SMP RT, libxl, libxlopt, MASS, PLIX RT<br />
            Compiler Services: Driver, builtin table, target validation<br />
            Build/Packaging: Installation tools, config files, build scripts/makefiles<br />
            Documentation: Product documentation, web pages, README files<br />
            Other: W-Code, disassembler, bolt, Makedepend }%</p>
            <div><font color="#000000">Fortran FE, Fortran RT, PGAS runtime</font></div>
            <div><font color="#000000">Fortran Test</font></div>
            <div><font color="#000000">ID : XL Language reference and Compiler reference</font></div>
            </td>
        </tr>
    </tbody>
</table>
<br />
<br />
<table width="100%" cellspacing="0" cellpadding="5" border="1" bgcolor="#ff6666">
    <tbody>
        <tr>
            <td width="100%" valign="top" align="center" style="font-size: 12pt; font-family: Arial; text-align: left;"><strong>Document Status: For Approval</strong> </td>
        </tr>
    </tbody>
</table>
<p><strong>Approvers Only:</strong> Click on the 'Approve' check-box beside your name in the table below if you agree with the technical and user interface content of this document; not checking your 'approve' check-box signifies you do not approve.</p>
<p>%Approvals%</p>
<p>Approval Comments</p>
<p>
<table cellspacing="0" cellpadding="5" border="1" style="font-size: 12pt; width: 100%; font-family: Arial; background-color: rgb(224, 255, 191); text-align: left;">
    <tbody>
        <tr>
            <td valign="top" align="left"><strong>Approvers</strong> (mandatory participation) </td>
            <td valign="top" align="left" style="font-weight: bold; color: rgb(0, 0, 255); background-color: rgb(255, 255, 255);">%Note{Insert the names of people who will have approval authority for this review. These people, in aggregate, are responsible for approving the technical and user interface content of the document. Generally, this list should include people who represent compiler components that will need to change if this review is approved.<br />
            The I0 Process document provides detailed guidance on choosing your list of approvers.<br />
            Use Access Control to add/delete people from this list. The initial access control list is populated with the people from the Component Reviewers section below. You can use Access Control to change their role to Approver, or add additional approvers.}%<br />
            %Approvers%</td>
        </tr>
        <tr>
            <td valign="top" align="left"><strong>Release Management Contact</strong> (optional participation) </td>
            <td valign="top" align="left" style="font-weight: bold; color: rgb(0, 0, 255); background-color: rgb(255, 255, 255);">%Release_Management_Contact% <br />
            %Note{Release Manager/Development Manager/Team Lead,<br />
            usually your team's representative at product status meetings. Use Access Control to add/change Release Management Contact.}%<br />
            </td>
        </tr>
        <tr>
            <td valign="top" align="left"><strong>Component Reviewers</strong> (optional participation) </td>
            <td valign="top" align="left" style="color: rgb(0, 0, 255); background-color: rgb(255, 255, 255);">%Note{These groups must be made aware of the I0. Assign at least one person representing each group. The names listed below are suggested contacts only, please assign whoever is appropriate:<br />
            <ul style="font-family: Arial;">
                <li><strong>C FE and related tools/libraries/driver:</strong><br />
                AIX - Philip Luk<br />
                Linux - Philip Luk<br />
                z/OS - Kendrick Wong<br />
                CELL - Larry Lindsay<br />
                UPC - Philip Luk </li>
                <li><strong>C++ FE and related tools/libraries/driver:</strong><br />
                AIX - Jeff Heath<br />
                Linux - Sasha Kasapinovic<br />
                z/OS - Michael Wong<br />
                CELL - Kevin Shin<br />
                </li>
                <li><strong>Fortran FE, ASTI, PLIX, and related tools/libraries/driver:</strong><br />
                AIX, PLIX - Rafik Zurob<br />
                Linux - Xing Xue<br />
                BG/L - Daniel Chen<br />
                CELL - Kelvin Li </li>
                <li><strong>PL/X Development:</strong><br />
                Kirk Crane<br />
                </li>
                <li><strong>TPO and associated tools/libraries (libxlopt, SMPRT, MASS):</strong><br />
                AIX - Arie Tal/Yan Zhang<br />
                Linux - Tommy Wong<br />
                z/OS - Chris Miclea<br />
                BG - Damien Bonaventure<br />
                CELL - Amy Wang </li>
                <li><strong>TOBEY and associated tools/libraries: (dis, libxl, bolt)</strong><br />
                AIX - Christopher Lapkowski<br />
                Linux - Irina rada<br />
                z/OS - Chwan-Hang Lee<br />
                BG - Damien Bonaventure, Leon Ding (Xialoliang Ding/Piscataway/IBM@IBMUS)<br />
                CELL - Dickson Chau<br />
                dis - Ian McIntosh<br />
                </li>
                <li><strong>WCode:</strong><br />
                Roland Froese </li>
                <li><strong>Disassembler<br />
                </strong>Ian McIntosh </li>
                <li><strong>Information Development:</strong><br />
                C/C++ - Wei Zhong Shan/China/IBM<br />
                Fortran - Lisa Wilkinson<br />
                </li>
                <li><strong>Customer Service and Support:</strong><br />
                AIX/Linux - Zoran Kulina<br />
                z/OS - Youssef Himo <br />
                Cell - Sean Kennedy </li>
                <li><strong>Compiler Enablement:</strong><br />
                Dwayne Moore </li>
                <li><strong>Fortran Test:</strong><br />
                Kobi Vinayagamoorthy<br />
                </li>
                <li><strong>C/C++ Test:</strong><br />
                Thomas Lee(z/OS)<br />
                Adrean Gatea (system p)<br />
                </li>
                <li><strong>PL/X Test:</strong><br />
                Anne Wylie </li>
                <li><strong>Build and Packaging Team:</strong><br />
                AIX - Chris Taylor<br />
                Linux - Viktor Ganich<br />
                BG - Steven Chen<br />
                Cell - Kevin Yuen<br />
                z/OS - Steve Chen<br />
                Dale Soldiuk (Please include Dale as optional on all reviews) </li>
                <li><strong>Performance Measurement and Analysis Team:<br />
                </strong>John Tam </li>
                <li><strong>Planning</strong><br />
                Mary Chan<br />
                </li>
            </ul>
            <p>The following groups must be notified of a W-Code change or if a change affects their language. They are optional otherwise.</p>
            <ul>
                <li><strong>PL/I:</strong><br />
                zOS and AIX - Peter Elderon (in SVL) </li>
                <li><strong>Cobol:</strong><br />
                AIX - Richard Nelson (in SVL) </li>
            </ul>
            <p>The following group must be notified of a front-end (C FE, or C++ FE) related change or other modification having a direct impact. Inclusion is optional otherwise.</p>
            <ul>
                <li><strong>Makedepend for USS:</strong><br />
                Christopher Taylor </li>
            </ul>
            <p>The following group must be notified whenever a change in debug WCODE is made, and any debugger related issues are involved.</p>
            <ul>
                <li><strong>Common Debug Architecture Development (CDA):</strong><br />
                Kendrick Wong </li>
            </ul>
            Use Access Control to add/delete people from this list.}% <br />
            %Component_Reviewers%</td>
        </tr>
        <tr>
            <td valign="top" align="left"><strong>Team Reviewers</strong> (optional participation) </td>
            <td valign="top" align="left" style="font-weight: bold; color: rgb(0, 0, 255); background-color: rgb(255, 255, 255);">%Note{List any additional people you feel need to participate in the review. These people do not have approval authority. Use Access Control to add/delete people from this list.}%<br />
            %Team_Reviewers%</td>
        </tr>
    </tbody>
</table>
</p>
<p><br />
<br />
</p>
<p>
<table cellspacing="2" cellpadding="2" border="1" style="font-size: 12pt; width: 100%; font-family: Arial; background-color: rgb(224, 255, 191); text-align: left;">
    <tbody>
        <tr>
            <td style="vertical-align: top; font-family: Arial;"><strong>Reviewers</strong>: Please click the 'Reviewed' checkbox beside your name to indicate your participation in the review. </td>
        </tr>
    </tbody>
</table>
</p>
<p>%Reviews%<br />
</p>
<p>
<table cellspacing="2" cellpadding="2" border="1" style="font-size: 12pt; width: 100%; font-family: Arial; background-color: rgb(224, 255, 191); text-align: left;">
    <tbody>
        <tr>
            <td style="vertical-align: top; font-family: Arial;"><strong>Access Change History</strong> %Note{Authors: Access Change History will list any changes to the access control done to the document draft. These changes would not be visible in a review. In a review, this section would only list the access changes done to the review itself.<br />
            Please note that changes to the access control of a review are not automatically reflected in the access control of the draft document.}% </td>
        </tr>
    </tbody>
</table>
</p>
<p>%CollapsedSection{<strong>Access Change History</strong>}{%Access_Change_History%}%<br />
</p>
<p>
<table width="100%" cellspacing="0" cellpadding="5" border="1" bgcolor="#bfbfff">
    <tbody>
        <tr>
            <td width="100%" valign="top" align="center" style="font-size: 12pt; font-family: Arial;"><strong>Feature Overview</strong> </td>
        </tr>
    </tbody>
</table>
</p>
<p>F2008 introduces a new statement, ERROR STOP, the execution of which initiates an error termination of an image.</p>
<h2>Key Requirements</h2>
<p>The ERROR STOP statement is required to comply with the F2008 standard, especially to support coarrays. </p>
<h2>Key Design Issues</h2>
<div>1. Using ERROR STOP in non-CAF programs.</div>
<div>If the source containing ERROR STOP is compiled without -qcaf, what will be the semantics? </div>
<div>&nbsp;</div>
<div>2. ERROR STOP with POE support -- POE limitations</div>
<div>CAF&nbsp;programs rely on POE to execute on aix and linux. POE interprets the return code from programs. If the exit code for a task is zero(0) or in the range of 2 to 127, then POE will make that task wait until all tasks have exited. If the exit code is 1 or greater than 128 (or less than 0), then POE will terminate the entire parallel job abruptly and display a message indicating the signal causing the termination based on POE's interpretation of the exit code.</div>
<div>As a result, if the stop-code specified with ERROR STOP is 0 or in the range of 2 to 127, the CAF program will hang since POE will make the calling image to wait while other images do not know this image has terminated. if the stop-code is in the range of 129 to 255, POE will likely display a message indicating the signal which is not true.</div>
<div>This won't work with STOP either. a stop-code of 1 or in the range of 129 to 255 will cause POE to terminate the program abruptly, while STOP is for normal termination.</div>
<div>&nbsp;</div>
<h2>Key Design Decisions</h2>
<div>1. The FE should always recognize the ERROR STOP statement and generate a call to _xlfErrorStop().&nbsp; The runtime deals with the difference in CAF or non-CAF. The error message from the ERROR STOP statement will be printed out on stderr and prefixed with &quot;ERROR STOP&quot;. This statement will also spill ieee exceptions information the same as the STOP statement. In sequential (non-CAF) mode, if the user does not explicitly specify an integer stop code, the program exit status from executing&nbsp;ERROR STOP will be 1, otherwise the value of the STOP CODE as appropriate.&nbsp;&nbsp;&nbsp;&nbsp;</div>
<div>&nbsp;</div>
<div>2. <span>Due to the limitation of POE,&nbsp;whatever the stop-code is, the value 1 is always supplied as the process exit status for the ERROR STOP statement, and the value 0 is always supplied as the process exit status for the STOP statement. In other words,&nbsp;</span><span>&nbsp;</span>if the stop-code specified is not&nbsp;one for the ERROR STOP statement, the runtime will replace it with&nbsp;one as the program exit status. If the stop-code specified with STOP is not zero, the runtime will replace it with zero as the program exit status. When a replacement is performed the runtime will issue a warning message to inform the user this is happening, Note this replacement is performed for CAF programs only.<span id="comments_content34963"> The stop code specified with the ERROR STOP statement will be output to the standard error unit.&nbsp; If any exception is signaling on that image, a warning indicating which exceptions are signaling will be issued. In addition,&nbsp; the runtime will add &quot;&lt;Image image_num&gt;&quot; in front of the output from the ERROR STOP statement if the runtime option errimagenum is set.&nbsp; The errimagenum runtime option will cause the runtime to add &quot;&lt;Image image_num&gt;&quot; to runtime messages as well as trace backs.&nbsp;</span>&nbsp;This design is standard conforming as <span id="comments_content34963">Fortran standard allows the stop-code to be processed in a processor-dependent manner.&nbsp; When an ERROR STOP is executed on an image, the whole coarray program will exit with the following termination sequence: the execution of ERROR STOP on an image initiates error termination, then, all images of the program that have not already initiated error termination initiate error termination, and finally, when&nbsp;all images have terminated execution, the program is terminated. </span></div>
<div><span></span>&nbsp;</div>
<h2>Testing Strategy</h2>
<p>1. Compile and run it as a normal program, i.e, there is no -qcaf specified<br />
2. Run with one image&nbsp;or more.<br />
3. Run with one node or more.</p>
<p>&nbsp;</p>
<table width="100%" cellspacing="0" cellpadding="5" border="1" bgcolor="#bfbfff">
    <tbody>
        <tr>
            <td width="100%" valign="top" align="center" style="font-size: 12pt; font-family: Arial;"><strong>User Documentation</strong> </td>
        </tr>
    </tbody>
</table>
<font color="#ff0000"><strong style="font-size: 20px; color: rgb(0, 128, 0);">
<h3>Overview</h3>
</strong></font>
<p>The ERROR STOP statement provides users the abitity to initiate error termination of a program.<br />
</p>
<strong style="font-size: 20px; color: rgb(0, 128, 0);"></strong><strong style="font-size: 20px; color: rgb(0, 128, 0);">
<h3><strong style="font-size: 20px; color: rgb(0, 128, 0);"></strong></h3>
</strong><strong style="font-size: 20px; color: rgb(0, 128, 0);">
<h3>User Benefits</h3>
</strong>
<p><font color="#339966"><font color="#000000">Error</font> </font>termination provides a means to stop execution of a program other than normal termination, that is, once an error termination has been initiated on an image, error termination is initiated on all images that have not already initiated error termination. The execution of a program terminates once all images terminate their execution.<br />
</p>
<strong style="font-size: 20px; color: rgb(0, 128, 0);">
<h3>Public Interface</h3>
</strong>
<div><font face="Verdana">ERROR STOP syntax:</font></div>
<div><font face="Verdana"></font></div>
<div><font face="Verdana">&nbsp;&nbsp; &nbsp;&gt;&gt; ------- ERROR STOP -----------------------------------------------------------------------------&lt;&lt;</font></div>
<div><font face="Verdana">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</font></div>
<div><font face="Verdana">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;|------------&nbsp;scalar-char-constant-expr&nbsp; --------------|</font></div>
<div><font face="Verdana">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|------------&nbsp;scalar-int-constant-expr&nbsp;-----------------|</font></div>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp; </div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>Runtime option:</div>
<div>errimagenum={yes | <u>no</u>}<br />
When errimagenum=yes is in effect, the image number of the executing image is prepended to any XL Fortran runtime error messages generated and the traceback information. This runtime option is only supported with executables compiled and linked with the -qcaf option. If errloc=yes is specified, the image number appears in front of the file name and line number information. If the IOMSG= specifier is present in an I/O statement, the image number is prepended in the message assigned to the variable specified by this option in the same format as displayed on standard error. </div>
<div>&nbsp;</div>
<strong style="font-size: 20px; color: rgb(0, 128, 0);">
<h3>Constraints</h3>
</strong>
<div>The scalar-int-constant-expr must be a scalar integer constant expression.<br />
<font face="Arial">The </font><font face="Verdana"><font face="Arial">scalar-char-constant-expr must be scalar character constant expression.</font><br />
</font></div>
<div>A pure subprogram must not contain an ERROR STOP statement.</div>
<div>If a statement label is specified in a DO statement, ERROR STOP must not be used to terminate that DO construct.<br />
</div>
<strong style="font-size: 20px; color: rgb(0, 128, 0);">
<h3>Rules</h3>
</strong>
<p>None.</p>
<strong style="font-size: 20px; color: rgb(0, 128, 0);">
<h3>Language Standard Considerations</h3>
</strong>
<p>ERROR STOP is a Fortran 2008 feature. Language level messages will be emitted if an ERROR STOP statement is used when the -qlanglvl option specifies Fortran 2003 or an older standard.</p>
<strong style="font-size: 20px; color: rgb(0, 128, 0);">
<h3>Messages</h3>
</strong>
<div><span id="comments_content36467"><a class="review" title="Click on the text to add a comment" href="javascript:edit('36467_1');"><span id="line_36467_1"></span></a></span><span id="comments_content36467"><a class="review" title="Click on the text to add a comment" href="javascript:edit('36467_1');"><span id="line_36467_1"></span></a></span>Run time message:<br />
T<span id="comments_content36467"><a class="review" title="Click on the text to add a comment" href="javascript:edit('36467_1');"><span id="line_36467_1"></span></a></span>he %C1 statement with stop code %I1 will terminate the program with return code %I2.<br />
where $C1 contains a string &quot;STOP&quot; or &quot;ERROR STOP&quot;.<br />
<br />
Compile time messages:<br />
The stop code in the %1$s statement must be a scalar constant expression of character or integer type.<br />
A pure subprogram must not contain the %1$s statement.<br />
</div>
<strong style="font-size: 20px; color: rgb(0, 128, 0);">
<h3>Performance Considerations</h3>
</strong>
<div>None.</div>
<strong style="font-size: 20px; color: rgb(0, 128, 0);">
<h3>Multi-Platform/Portability Considerations</h3>
</strong>
<div>None.</div>
<strong style="font-size: 20px; color: rgb(0, 128, 0);">
<h3>Migration/Co-Existence/Binary-Compatibility Considerations</h3>
</strong>
<p>None.</p>
<strong style="font-size: 20px; color: rgb(0, 128, 0);">
<h3>Debug Considerations</h3>
</strong>
<p>None.</p>
<strong style="font-size: 20px; color: rgb(0, 128, 0);">
<h3>Samples</h3>
</strong>
<p><font face="Courier New">The following two examples show various forms of ERROR STOP and potential behaviors <br />
</font></p>
<p><font face="Courier New">&nbsp; <br />
</font></p>
<p><font face="Courier New">1. CAF example:<br />
<br />
INTEGER, SAVE :: scoarr[*] = -1<br />
INTEGER, SAVE :: acoarr(3)[*] = -1<br />
&nbsp;<br />
IF ( scoarr .NE. -1 ) ERROR STOP &quot;Initial value wrong!&quot; <br />
! If the initialization for scoarr is wrong, the message on stderr will be &quot;ERROR STOP Initial value wrong!&quot;,<br />
! and the exit status will be 1.<br />
&nbsp; <br />
IF ( ANY(acoarr[THIS_IMAGE()] .NE. -1) ) ERROR STOP<br />
! If the initialization for acoarr is wrong, there is no message on stderr,<br />
! and the exit status will be 1.<br />
&nbsp;<br />
SYNC ALL<br />
&nbsp;<br />
IF (THIS_IMAGE() .EQ. NUM_IMAGES()) THEN<br />
&nbsp; scoarr[1] = 0<br />
&nbsp; acoarr[1] = 0 <br />
ELSE<br />
&nbsp; scoarr[THIS_IMAGE()+1] = THIS_IMAGE()<br />
&nbsp; acoarr[THIS_IMAGE()+1] = 0<br />
END IF<br />
&nbsp;<br />
SYNC ALL<br />
&nbsp;<br />
IF ( scoarr .NE. THIS_IMAGE()-1 ) ERROR STOP 127<br />
! If the value for scoarr is not equal to THIS_IMAGE()-1, the message on stderr will be <br />
! &quot;ERROR STOP 127&quot;<br />
! &quot;The ERROR STOP statement with stop code 127 will terminate the program with return code 1&quot;<br />
! and the exit status will be 1.<br />
<br />
IF ( ANY(acoarr .NE. 0) ) ERROR STOP 0<br />
! If the values for acoarr are not 0, the message on stderr will be <br />
! &quot;ERROR STOP 0&quot;<br />
! &quot;The ERROR STOP statement with stop code 0 will terminate the program with return code 1&quot;<br />
! and the exit status will be 1.<br />
&nbsp;<br />
STOP &quot;Good!&quot;<br />
&nbsp;<br />
END<br />
<br />
<br />
2. Non CAF example:<br />
<br />
INTEGER, SAVE :: s = -1<br />
INTEGER, SAVE :: arr(3) = -1<br />
&nbsp;<br />
IF ( s .NE. -1 ) ERROR STOP &quot;Initial value wrong!&quot; <br />
! If the initialization for s is wrong, the message on stderr will be &quot;ERROR STOP Initial value wrong!&quot;,<br />
! and the exit status will be 1.<br />
&nbsp; <br />
IF ( ANY(arr .NE. -1) ) ERROR STOP<br />
! If the initialization for arr is wrong, there is no message on stderr,<br />
! and the exit status will be 1.<br />
&nbsp;<br />
SYNC ALL<br />
&nbsp;<br />
s = 1<br />
arr = 1<br />
&nbsp;<br />
IF ( s .NE. 1 ) ERROR STOP 127<br />
! If the value for s is not 1, the message on stderr will be &quot;ERROR STOP 127&quot;,<br />
! and the exit status will be 127.<br />
<br />
IF ( ANY(arr .NE. 1) ) ERROR STOP 0<br />
! If the values for arr are not 1, the message on stderr will be &quot;ERROR STOP 0&quot;,<br />
! and the exit status will be 0.<br />
&nbsp;<br />
STOP &quot;Good!&quot;<br />
&nbsp;<br />
END<br />
<br />
&nbsp; <br />
</font></p>
<p><font face="Courier New"></font></p>
<font face="Courier New"></font>
<p>&nbsp;</p>
<table width="100%" cellspacing="0" cellpadding="5" border="1" bgcolor="#bfbfff">
    <tbody>
        <tr>
            <td width="100%" valign="top" align="center" style="font-size: 12pt; font-family: Arial;"><strong>Internal Compiler Team Information</strong> </td>
        </tr>
    </tbody>
</table>
<strong style="font-size: 20px; color: rgb(0, 128, 0);">
<h3>Product Dependencies</h3>
</strong>
<div>None.<br />
</div>
<strong style="font-size: 20px; color: rgb(0, 128, 0);">
<h3>Patent/Disclosure Implications</h3>
</strong>
<div>None.</div>
<strong style="font-size: 20px; color: rgb(0, 128, 0);">
<h3>Build and Packaging Considerations</h3>
</strong>
<p>None.</p>
<h3><font color="#339966">NLS (Unicode) Considerations</font></h3>
<p>None.</p>
<h3><font color="#339966">Information Development Impacts</font></h3>
<div><font size="2">In the section of pure procedures from the language reference, add in ERROR STOP as a disallowed statement.<br />
In the the language reference&nbsp; we need to add a new section on the ERROR STOP statement similar to the section on the STOP statement. Specifically we need to specify the semantics and the return code of the statement on multiple images. In addition,&nbsp;it is necessary </font>to explain the concepts of execution, synchronization and termination, etc.&nbsp;&nbsp;In the Non-finalized entities section, add in ERROR STOP.</div>
<div>&nbsp;</div>
<div><font size="2">In&nbsp;Section Setting runtime options&nbsp;of&nbsp;the compiler reference,&nbsp;add in errimagenum.</font></div>
<strong style="font-size: 20px; color: rgb(0, 128, 0);">
<h3><font color="#339966">Testing Considerations</font></h3>
</strong>
<p>Test needs to include the following areas:<br />
1. Verify the ERROR STOP behavior as specified.<br />
2. Interaction of among ERROR STOP, STOP and END.<br />
3. Verify the ERROR STOP behavior under various numbers of images.</p>
<strong style="font-size: 20px; color: rgb(0, 128, 0);">
<table width="100%" cellspacing="0" cellpadding="5" border="1" bgcolor="#bfbfff">
    <tbody>
        <tr>
            <td width="100%" valign="top" align="center" style="font-size: 12pt; font-family: Arial;"><strong>High-Level Implementation Design</strong> </td>
        </tr>
    </tbody>
</table>
<strong style="font-size: 20px; color: rgb(0, 128, 0);">
<h3>Implementation Design Overview</h3>
</strong></strong>
<p>Language syntax and constraint:</p>
<p><font face="Verdana">R856 error-stop-stmt is ERROR STOP [ stop-code ]</font></p>
<p><font face="Verdana">R857 stop-code is scalar-default-char-constant-expr <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; or scalar-int-constant-expr</font><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />
C850 (R857) The scalar-int-constant-expr shall be of default kind.</p>
<p><br />
Internal production rules:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />
<font face="Verdana">&lt;error stop stmt&gt; ::=&nbsp;&nbsp;&nbsp;&nbsp; ERROR STOP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ERROR STOP &lt;stop code&gt;<br />
&lt;stop code&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; ::=&nbsp;&nbsp;&nbsp;&nbsp; &lt;expr&gt;</font></p>
<p><font face="Verdana">&lt;okafterif stmt&gt; -&gt;&nbsp;&nbsp;&nbsp; &lt;ptr assignment stmt&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; ...<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; &lt;error stop stmt&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />
&lt;exec stmt&gt; -&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;assign stmt&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; &lt;error stop stmt&gt;</font></p>
<strong style="font-size: 20px; color: rgb(0, 128, 0);">
<p><strong style="font-size: 20px; color: rgb(0, 128, 0);">Inter-Component Communication/Interfaces</strong> </p>
</strong>
<p>CAF runtime interfaces:</p>
<p>/*<br />
&nbsp;* The _xlfErrorStop routine implements the ERROR STOP statement.<br />
&nbsp;*/<br />
void _xlfErrorStop(FSTRING tag, INT return_code, const UINT32 * control) <br />
</p>
<p>The stop-code is passed through tag and/or return_code.&nbsp; <br />
If the complation command is xlf2003 or xlf2008 (-qxlf2003=stopexcept), informational messages are displayed when <br />
IEEE floating-point exceptions are signaled.&nbsp; This is passed through control.&nbsp; 'control' is NULL otherwise.</p>
<p>PGAS runtime interface:</p>
<p>The CAF runtime will call the following routine.</p>
<p>/*<br />
&nbsp;* __xlcaf_error_stop terminates the execution for all active images.<br />
&nbsp;*/<br />
void __xlcaf_error_stop(int return_code) <br />
</p>
<p>To be specific, FE translates ERROR STOP to a call to _xlfErrorStop, and that _xlfErrorStop in turn calls __xlfcaf_error_stop in the CAF case.</p>
<p>&nbsp; <br />
</p>
<h3><font color="#339966">Scientific Research and Experimental Development</font></h3>
<p>&nbsp;None.</p>
<h3><strong style="font-size: 20px; color: rgb(0, 128, 0);"><font color="#339966">Other Implementation Design Information</font></strong> </h3>
<p>None.</p>
<strong style="font-size: 20px; color: rgb(0, 128, 0);"><strong style="font-size: 20px; color: rgb(0, 128, 0);">
<h3>
<table width="100%" cellspacing="0" cellpadding="5" border="1" bgcolor="#bfbfff">
    <tbody>
        <tr>
            <td width="100%" valign="top" align="center" style="font-size: 12pt; font-family: Arial;"><strong>Appendix/References</strong> </td>
        </tr>
    </tbody>
</table>
</h3>
</strong></strong>
<p><br />
&nbsp;Fortran 2008 WD 1539-1, Section 8.4 -- STOP and ERROR STOP statements of the Fortran 2008 Standard.&nbsp; </p><!--HTML Wrapper--></body></html>