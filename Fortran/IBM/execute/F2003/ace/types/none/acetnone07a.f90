!******************************************************************************
!*  ===========================================================================
!*
!*  TEST CASE NAME             : acetnone07a
!*
!*  DATE                       : 2006-08-01
!*
!*  PRIMARY FUNCTIONS TESTED   : Array Constructor Enhancements
!*
!*  SECONDARY FUNCTIONS TESTED : BOZ literals in AC's with no type specifier (reals)
!*
!*  REFERENCE                  : Feature Number 289053
!*
!*  REQUIRED COMPILER OPTIONS  :
!*
!*  KEYWORD(S)                 : typeless, boz, real
!*  TARGET(S)                  :
!*  NUMBER OF TESTS CONDITIONS :
!*
!*  DESCRIPTION
!*
!*  Here we test boz literals masquerading as real numbers.
!*
!*  Boz literals and Hollerith constants are typeless, so including them in an
!*  array constructor lacking a type specifier is a problem, because we don't
!*  know what type to assign to the AC.  The 2003 standard only allows them in
!*  one of three intrinsics (int, real, and cmplx) and in data statements.
!*  As an extension, they're allowed in some other contexts like those below.
!*  Because they are typeless, they cannot appear in a select type or be passed
!*  as unlimited polymorphic dummy args.
!*
!*  Note: Unlike Hollerith constants, boz literals are part of the standard.
!*
!*  There are companion tests to these in types/intrinsics.
!*
!* ============================================================================
!234567890123456789012345678901234567890123456789012345678901234567890123456789

program acetnone07a

  use, intrinsic :: ieee_features
  use, intrinsic :: ieee_arithmetic

  implicit none
  integer :: i

  real(4) :: rArray4(6), exp4(6)
  real(8) :: rArray8(6), exp8(6)

  exp4    = (/ 0.0_4, -0.0_4, 1.0_4, huge(0.0_4), &
               IEEE_VALUE(0.0_4, IEEE_POSITIVE_INF), IEEE_VALUE(0.0_4, IEEE_QUIET_NAN) /)

  rArray4 = (/z'00000000', z'80000000', z'3f800000', &
              z'7f7fffff', z'7f800000', z'7fc00000'/)
  call check4(exp4, rArray4, 10_4)
  call check4(exp4, &
              (/z'00000000', z'80000000', z'3f800000', &
                z'7f7fffff', z'7f800000', z'7fc00000'/), &
              11_4)

  rArray4 = (/(z'00000000',z'80000000',z'3f800000',i=1,1), &
              (z'7f7fffff',z'7f800000',z'7fc00000',i=1,1)/)
  call check4(exp4, rArray4, 12_4)
  call check4(exp4, &
              (/(z'00000000',z'80000000',z'3f800000',i=1,1), &
                (z'7f7fffff',z'7f800000',z'7fc00000',i=1,1)/), &
              13_4)

  rArray4 = (/o'00000000000', o'20000000000', o'07740000000', &
              o'17737777777', o'17740000000', o'17760000000'/)
  call check4(exp4, rArray4, 20_4)
  call check4(exp4, &
              (/o'00000000000', o'20000000000', o'07740000000', &
                o'17737777777', o'17740000000', o'17760000000'/), &
              21_4)

  rArray4 = (/(o'00000000000', o'20000000000', o'07740000000',i=1,1), &
              (o'17737777777', o'17740000000', o'17760000000',i=1,1) /)
  call check4(exp4, rArray4, 22_4)
  call check4(exp4, &
              (/(o'00000000000', o'20000000000', o'07740000000',i=1,1), &
                (o'17737777777', o'17740000000', o'17760000000',i=1,1)/), &
              23_4)

  rArray4 = (/b'00000000000000000000000000000000', b'10000000000000000000000000000000', &
              b'00111111100000000000000000000000', b'01111111011111111111111111111111', &
              b'01111111100000000000000000000000', b'01111111110000000000000000000000'/)
  call check4(exp4, rArray4, 30_4)
  call check4(exp4, &
              (/b'00000000000000000000000000000000', b'10000000000000000000000000000000', &
                b'00111111100000000000000000000000', b'01111111011111111111111111111111', &
                b'01111111100000000000000000000000', b'01111111110000000000000000000000'/), &
              31_4)

  rArray4 = (/(b'00000000000000000000000000000000', b'10000000000000000000000000000000',i=1,1), &
              (b'00111111100000000000000000000000', b'01111111011111111111111111111111',i=1,1), &
              (b'01111111100000000000000000000000', b'01111111110000000000000000000000',i=1,1)/)
  call check4(exp4, rArray4, 32_4)
  call check4(exp4, &
              (/(b'00000000000000000000000000000000', b'10000000000000000000000000000000',i=1,1), &
                (b'00111111100000000000000000000000', b'01111111011111111111111111111111',i=1,1), &
                (b'01111111100000000000000000000000', b'01111111110000000000000000000000',i=1,1)/), &
              33_4)

  exp8    = (/ 0.0_8, -0.0_8, 1.0_8, huge(0.0_8), &
               IEEE_VALUE(0.0_8, IEEE_POSITIVE_INF), IEEE_VALUE(0.0_8, IEEE_QUIET_NAN) /)

  rArray8 = (/z'0000000000000000', z'8000000000000000', z'3ff0000000000000', &
              z'7fefffffffffffff', z'7ff0000000000000', z'7ff8000000000000' /)
  call check8(exp8, rArray8, 40_4)
  call check8(exp8, &
              (/z'0000000000000000', z'8000000000000000', z'3ff0000000000000', &
                z'7fefffffffffffff', z'7ff0000000000000', z'7ff8000000000000' /), &
              41_4)

  rArray8 = (/(z'0000000000000000', z'8000000000000000', z'3ff0000000000000',i=1,1), &
              (z'7fefffffffffffff', z'7ff0000000000000', z'7ff8000000000000',i=1,1) /)
  call check8(exp8, rArray8, 42_4)
  call check8(exp8, &
              (/(z'0000000000000000', z'8000000000000000', z'3ff0000000000000',i=1,1), &
                (z'7fefffffffffffff', z'7ff0000000000000', z'7ff8000000000000',i=1,1) /), &
              43_4)

  rArray8 = (/o'0000000000000000000000', o'1000000000000000000000', &
              o'0377600000000000000000', o'0777577777777777777777', &
              o'0777600000000000000000', o'0777700000000000000000' /)
  call check8(exp8, rArray8, 50_4)
  call check8(exp8, &
              (/o'0000000000000000000000', o'1000000000000000000000', &
                o'0377600000000000000000', o'0777577777777777777777', &
                o'0777600000000000000000', o'0777700000000000000000' /), &
              51_4)

  rArray8 = (/(o'0000000000000000000000', o'1000000000000000000000',i=1,1), &
              (o'0377600000000000000000', o'0777577777777777777777',i=1,1), &
              (o'0777600000000000000000', o'0777700000000000000000',i=1,1) /)
  call check8(exp8, rArray8, 52_4)
  call check8(exp8, &
              (/(o'0000000000000000000000', o'1000000000000000000000',i=1,1), &
                (o'0377600000000000000000', o'0777577777777777777777',i=1,1), &
                (o'0777600000000000000000', o'0777700000000000000000',i=1,1) /), &
              53_4)

  rArray8 = (/b'0000000000000000000000000000000000000000000000000000000000000000', &
              b'1000000000000000000000000000000000000000000000000000000000000000', &
              b'0011111111110000000000000000000000000000000000000000000000000000', &
              b'0111111111101111111111111111111111111111111111111111111111111111', &
              b'0111111111110000000000000000000000000000000000000000000000000000', &
              b'0111111111111000000000000000000000000000000000000000000000000000' /)
  call check8(exp8, rArray8, 60_4)
  call check8(exp8, &
              (/b'0000000000000000000000000000000000000000000000000000000000000000', &
                b'1000000000000000000000000000000000000000000000000000000000000000', &
                b'0011111111110000000000000000000000000000000000000000000000000000', &
                b'0111111111101111111111111111111111111111111111111111111111111111', &
                b'0111111111110000000000000000000000000000000000000000000000000000', &
                b'0111111111111000000000000000000000000000000000000000000000000000' /), &
              61_4)

  rArray8 = (/(b'0000000000000000000000000000000000000000000000000000000000000000',i=1,1), &
              (b'1000000000000000000000000000000000000000000000000000000000000000',i=1,1), &
              (b'0011111111110000000000000000000000000000000000000000000000000000',i=1,1), &
              (b'0111111111101111111111111111111111111111111111111111111111111111',i=1,1), &
              (b'0111111111110000000000000000000000000000000000000000000000000000',i=1,1), &
              (b'0111111111111000000000000000000000000000000000000000000000000000',i=1,1) /)
  call check8(exp8, rArray8, 62_4)
  call check8(exp8, &
              (/(b'0000000000000000000000000000000000000000000000000000000000000000',i=1,1), &
                (b'1000000000000000000000000000000000000000000000000000000000000000',i=1,1), &
                (b'0011111111110000000000000000000000000000000000000000000000000000',i=1,1), &
                (b'0111111111101111111111111111111111111111111111111111111111111111',i=1,1), &
                (b'0111111111110000000000000000000000000000000000000000000000000000',i=1,1), &
                (b'0111111111111000000000000000000000000000000000000000000000000000',i=1,1) /), &
              63_4)

contains

  subroutine check4(exp, actual, ecode)
    real (4) :: exp(:), actual(:)
    integer(4):: ecode, retcode, last, i
    last = ubound(exp,1)
    retcode = 0
    do i=1,last-1
       if (exp(i) /= actual(i) &
           .or. sign(1.0_4,exp(i)) /= sign(1.0_4,actual(i))) then
          print *, "Expected #",i,"(4)", exp(i), ", got", actual(i)
          retcode = ecode
       end if
    end do
    if (actual(last) == actual(last)) then
       print *, "Expected QNaN(4), got", actual(last)
       retcode = ecode
    end if
    if (retcode /= 0) call zzrc(retcode)
  end subroutine check4

  subroutine check8(exp, actual, ecode)
    real (8) :: exp(:), actual(:)
    integer(4):: ecode, retcode, last, i
    last = ubound(exp,1)
    retcode = 0
    do i=1,last-1
       if (exp(i) /= actual(i) &
           .or. sign(1.0_8,exp(i)) /= sign(1.0_8,actual(i))) then
          print *, "Expected #",i,"(8)", exp(i), ", got", actual(i)
          retcode = ecode
       end if
    end do
    if (actual(last) == actual(last)) then
       print *, "Expected QNaN(8), got", actual(last)
       retcode = ecode
    end if
    if (retcode /= 0) call zzrc(retcode)
  end subroutine check8

end program acetnone07a
